"use strict";var express=require("express"),fs=require("fs"),bodyParser=require("body-parser"),path=require("path"),mysql=require("mysql2"),app=express(),cors=require("cors"),port=3e3;app.use(cors({origin:["http://localhost:8100","http://192.168.1.44:4200"]})),app.use(bodyParser.json()),app.use(express.json());var db=mysql.createConnection({host:"localhost",user:"root",password:"root",database:"DreamsApp"});db.connect(function(a){a?console.error("Error al conectar a la base de datos:",a.stack):console.log("Conectado a la base de datos MySQL.")}),app.get("/api/data/:table",function(a,o){var e=a.params.table;db.query("SELECT * FROM ??",[e],function(a,e){a?o.status(500).json({error:"Error al ejecutar la consulta"}):o.json(e)})}),app.get("/api/promosheladeria/active",function(a,o){db.query("SELECT * FROM PromosHeladeria WHERE Activo = 1",function(a,e){if(a)return console.error("Error al ejecutar la consulta:",a),void o.status(500).json({error:"Error al ejecutar la consulta"});o.json(e)})}),app.get("/api/data/:table/:id",function(a,o){var e=a.params,r=e.table,t=e.id;db.query("SELECT * FROM ?? WHERE id = ?",[r,t],function(a,e){a?o.status(500).json({error:"Error al ejecutar la consulta"}):0!==e.length?o.json(e[0]):o.status(404).json({error:"Dato no encontrado"})})}),app.post("/api/data/:table",function(a,o){var e=a.params.table,r=a.body.name;if(!r)return o.status(400).json({error:"El campo name es requerido"});db.query("INSERT INTO ?? (nombre) VALUES (?)",[e,r],function(a,e){a?o.status(500).json({error:"Error al insertar datos"}):o.status(201).json({id:e.insertId,name:r})})}),app.put("/api/data/:table/:id",function(a,o){var e=a.params,r=e.table,t=e.id,s=a.body.name;if(!s)return o.status(400).json({error:"El campo name es requerido"});db.query("UPDATE ?? SET nombre = ? WHERE id = ?",[r,s,t],function(a,e){a?o.status(500).json({error:"Error al actualizar datos"}):0!==e.affectedRows?o.json({id:t,name:s}):o.status(404).json({error:"Dato no encontrado"})})}),app.delete("/api/data/:table/:id",function(a,o){var e=a.params,r=e.table,t=e.id;db.query("DELETE FROM ?? WHERE id = ?",[r,t],function(a,e){a?o.status(500).json({error:"Error al eliminar datos"}):0!==e.affectedRows?o.status(204).send():o.status(404).json({error:"Dato no encontrado"})})}),app.get("/api/complementos",function(a,o){var e=a.query.table;if(!e)return o.status(400).json({error:"El par치metro 'table' es requerido"});var r="";"Cubatas"===e?r="SELECT * FROM Complementos_Cubata":"Helados Personalizados"===e?r="SELECT * FROM Complementos_Helado":"Cafes"===e?r="SELECT * FROM Complementos_Cafe ":"Bolleria"===e?r="SELECT * FROM Complementos_Bolleria ":"Ginebras"===e?r="SELECT * FROM Complementos_Gins ":"Infusiones"===e?r="SELECT * FROM Complementos_Infusiones ":"Batidos Helados"===e&&(r="SELECT * FROM Complementos_Batidos "),db.query(r,[e],function(a,e){a?o.status(500).json({error:"Error al ejecutar la consulta"}):o.json(e)})}),app.get("/api/productos/:tableName/:productName/ncomplementos",function(a,o){var e=a.params,r=e.tableName,t=e.productName;db.query("SELECT Ncomplementos FROM ?? WHERE Nombre = ?",[r,t],function(a,e){if(a)return console.error("Error al ejecutar la consulta:",a),void o.status(500).json({error:"Error al ejecutar la consulta"});0!==e.length?o.json({Ncomplementos:e[0].Ncomplementos}):o.status(404).json({error:"Producto no encontrado"})})}),app.post("/api/write-to-file",function(a,e){var o=a.body.data,r=new Date,t=new Date(r.getTime()-6e4*r.getTimezoneOffset()).toISOString().split("T")[0],s="datos_".concat(t,".txt"),n=path.join(__dirname,"files",s),i="\n--------------------\n".concat(o);fs.appendFile(n,i,function(a){if(a)return console.error("Error al a침adir datos al archivo:",a),e.status(500).json({error:"Error al a침adir datos al archivo"});e.json({message:"Datos a침adidos al archivo"})})});var activeTables=[];app.get("/active-tables",function(a,e){e.json(activeTables)}),app.post("/active-tables",function(a,e){var o=a.body.code;activeTables.includes(o)||activeTables.push(o),e.json(activeTables)}),app.delete("/active-tables/:code",function(a,e){var o=a.params.code;activeTables=activeTables.filter(function(a){return a!==o}),e.json(activeTables)}),app.get("/api/tables",function(a,r){db.query("SHOW TABLES",function(a,e){if(a)r.status(500).json({error:"Error al obtener las tablas"});else{var o=e.map(function(a){return Object.values(a)[0]});r.json(o)}})}),app.get("/api/tables/:tableName",function(a,o){var e=a.params.tableName;db.query("SELECT * FROM ??",[e],function(a,e){a?o.status(500).json({error:"Error al obtener los datos de la tabla"}):o.json(e)})}),app.put("/api/tables/:tableName/:id",function(a,o){var e=a.params.tableName,r=a.params.id,t=a.body;db.query("UPDATE ?? SET ? WHERE id = ?",[e,t,r],function(a,e){a?o.status(500).json({error:"Error al actualizar los datos"}):o.json({message:"Datos actualizados correctamente"})})}),app.listen(port,function(){console.log("Servidor corriendo Correctamente")});
//# sourceMappingURL=server.min.js.map
